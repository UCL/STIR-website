<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STIR: /home/sirfuser/devel/STIRdistrib/STIR/src/utilities/ecat/ecat_swap_corners.cxx File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">STIR
   &#160;<span id="projectnumber">6.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_43e0a1f539e00dcfa1a6bc4d4fee4fc2.html">home</a></li><li class="navelem"><a class="el" href="dir_0b75bdf102f5cf4910d6429d56a66609.html">sirfuser</a></li><li class="navelem"><a class="el" href="dir_bf00ec6aee8436d9dd9bdb27c8ba69c2.html">devel</a></li><li class="navelem"><a class="el" href="dir_f033b80aa1e53a09c27a870e567321ae.html">STIRdistrib</a></li><li class="navelem"><a class="el" href="dir_dee4efe29267f8f1fbd97b7b185bc024.html">STIR</a></li><li class="navelem"><a class="el" href="dir_4d737faa33632d919b5a76c7a560514d.html">src</a></li><li class="navelem"><a class="el" href="dir_64801a3d1b1f0e36b62ae4d60cd8bffe.html">utilities</a></li><li class="navelem"><a class="el" href="dir_81eb5c26b3332c04a980502bd40514a0.html">ecat</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ecat_swap_corners.cxx File Reference<div class="ingroups"><a class="el" href="group__STIR.html">STIR</a> &raquo; <a class="el" href="group__main__programs.html">Executables</a> &raquo; <a class="el" href="group__utilities.html">Utility programs</a><a class="el" href="group__STIR.html">STIR</a> &raquo; <a class="el" href="group__STIR__library.html">STIR library</a> &raquo; <a class="el" href="group__IO.html">Input/Output Library</a> &raquo;  &#124; <a class="el" href="group__ECAT.html">ECAT6 ... ECAT8 support in the IO library</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>A (slightly dangerous) utility to perform so-called corner-swapping for ECAT6 projection data.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="ProjDataInterfile_8h_source.html">stir/ProjDataInterfile.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utilities_8h_source.html">stir/utilities.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="SegmentBySinogram_8h_source.html">stir/SegmentBySinogram.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Succeeded_8h_source.html">stir/Succeeded.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="error_8h_source.html">stir/error.h</a>&quot;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;algorithm&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a0c8186d9b9b7880309c27230bbb5e69d"><td class="memItemLeft" align="right" valign="top"><a id="a0c8186d9b9b7880309c27230bbb5e69d"></a>
typedef unsigned char&#160;</td><td class="memItemRight" valign="bottom"><b>byte</b></td></tr>
<tr class="separator:a0c8186d9b9b7880309c27230bbb5e69d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top"><a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A (slightly dangerous) utility to perform so-called corner-swapping for ECAT6 projection data. </p>
<dl class="section author"><dt>Author</dt><dd>Christian Michel </dd>
<dd>
CTI PET Inc </dd>
<dd>
Kris Thielemans</dd></dl>
<dl class="section user"><dt>Usage</dt><dd><div class="fragment"><div class="line">ecat_swap_corners out_name in_name</div></div><!-- fragment --></dd></dl>
<dl class="section user"><dt>What does it do?</dt><dd></dd></dl>
<p>For some historical reason, CTI scanners store 3D sinograms sometimes in a 'corner-swapped' mode. What happens is that some corners of the positive and negative segments are interchanged. (As a consequence, segment 0 is never affected).</p>
<p>Below is a summary of what Kris Thielemans understood about corner-swapping from various emails with CTI people. However, he might have totally misunderstood this, so beware!</p>
<p>Corner-swapped mode occurs ALWAYS for ECAT6 data straight from the scanner. However, data which have been normalised using the import_3dscan utility from CTI are already corner-swapped correctly. Unfortunately, there is no field in the ECAT6 header that allows you to find out which mode it is in.</p>
<p>For ECAT7 data, the situation is even more confusing. Data acquired directly in projection data have to be corner-swapped when the acquisition was in 'volume-mode' (i.e. stored by sinograms), but NOT when acquired in 'view-mode' (i.e. stored by view). It seems that bkproj_3D_sun follows this convention by assuming that any ECAT7 projection data stored in 'volume-mode' has to be corner swapped, and when it writes projection data in 'view-mode', it does the corner swapping for you. So, although there is strictly speaking no field in the ECAT7 header concerning corner swapping, it seems that the storage mode field determines the corner swapping as well. <br />
 When the data is acquired in listmode, this changes somewhat. Apparently, there is a parameter in the set-up of listmode scans that allows you to put the ACS in 'volume-mode' or 'view-mode'. The resulting listmode files encode the sinogram coordinates then with corner-swapping or without. After the acquisition, the listmode data has then to be binned into projection data. It is then up to the binning program to take this corner-swapping into account. This is easiest to do by generating 'volume-mode' projection data when a 'volume-mode' when the listmode setup was in 'volume-mode', and similar for 'view-mode'.<br />
 If this sounds confusing to you, KT would agree. Here seems to be the best thing to do:</p>
<p><em>Do all acquisitions in 'view-mode', set-up your listmode scan in 'view-mode', bin the data in 'view-mode'. Forget about corner-swapping.</em></p>
<p>If you cannot do this, then this utility will corner-swap the projection data for you.</p>
<dl class="section user"><dt>Who implemented this and how was it tested?</dt><dd></dd></dl>
<p>The actual corner swapping code was supplied by Christian Michel, based on code by Larry Byars.<br />
 KT has tested it by performing a very long cylinder scan in 'volume-mode' on the ECAT 966, and looking at the delayeds. The oblique segments had obvious discontinuities in the efficiency patterns. After applyying this utility, these discontinuities appeared.</p>
<dl class="section warning"><dt>Warning</dt><dd>This utility does not (and cannot) check for you if the data has to be corner-swapped or not. So, it can do the wrong thing. </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jul 23 2024 09:13:13 for STIR by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
